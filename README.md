# Workflow thesis code

A set of python scripts which utilizes (among other modules) the [gnssr4water module](https://github.com/ITC-Water-Resources/gnssr4water).

Subject to change

## 1. Install the necessary System tools
The workflows needs a system with Python3 installed . On windows, there are several options to achieve this:
1. Install [WSL with an appropriate distribution (e.g. Ubuntu)](https://documentation.ubuntu.com/wsl/en/latest/howto/install-ubuntu-wsl2/)
2. Use [Anaconda](https://earthlab-education.github.io/Earth-Analytics-2023-01-Intro/python-open-source-tool-setup/setup-02-setup-git-bash-and-anaconda.html)
3. Use a [Python setup together with Visual studio code](https://code.visualstudio.com/docs/python/python-tutorial)
4. Other options

Using the WSL option (1) above, some other tools are recommended to be installed too system-wide. For that open an Ubuntu (bash) terminal and execute the following

```
sudo apt-get update
sudo apt-get install build-essential  python3-venv python3-xarray python3-gdal python3-fiona 
```

It is convenient to generate [a ssh key pair and register the public ssh key in github](https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account). The git clone commands below assume you've setup a ssh pair and registered it in github. Alternatively, one can use the https url's found at the github repoitories.

## 2. Clone this repository and setup a python virtual environment
It's recommended to  setup a dedicated Python environment to gather the necessary tools needed to run the workflow scripts. Oopen a terminal and navigate to a working directory
```
cd /path/to/workingdirectory
mkdir gimathesis
cd gimathesis
```
Clone this repository
```
git clone  git@github.com:ankom-wiz/thesis_code.git
```

Make a Python virtual environment (venv)
```
cd thesis_code
python -m venv pygima --system-site-packages
```
Note that the `--system-site-packages` options is not compulsory, but can be useful if one wants the virtual environment to use the system-wide installed python packages (as installed above with `apt-get`).

Activate the virtual environment:
```
source pygima/bin/activate
```

Let's assume you want to edit/develop the gnssr4water module:

```
cd ..
git clone git@github.com:ITC-Water-Resources/gnssr4water.git
```

Install the gnssr4water module as an editable install
```
cd gnssr4water
pip install -e .
```

## 2A. Updating the gnssr4water repository from the github repository
If you've already cloned the repository and jsut want to retrieve newest changes from github, you can do
```
git pull origin main
pip install -e .
```


## 3. Running the workflow scripts
Once steps 1 and 2 have been successfull, one can start executing the workflow scripts and possibly adapting them using your preferred editor. Scripts are numbered chronologically as for example `00_downloaddata.py`. So higher numbered scripts possibly depend on output generated by scripts with lower numbers. A template script (`xx_test.py`) can be used as a start.

A script can be executed after the pygima environment is activated.
First change back to the `thesis_code` directory:
```
cd ../thesis_code
```
If not done already activate the pygima venv
```
source pygima/bin/activate
```

Now you can execute a script:
```
python3 01_makemasks.py
```

## 4. Advanced: Adapting code in the gnssr4water module 
Since we've installed the gnssr4water tool as editable (`-e` flag in `pip`), we can directly edit the code in the gnssr4water directory. The code changes will be directly available in the `pygia` environment.

Don't edit the main branch directly but create a new branch (e.g. named newfeature) based on the main branch first:
```
cd ../gnssr4water
git switch -c newfeature
```
The Python files of the module are located in `src/gnssr4water/` and can be edited by a text editor of choice

## 5. Git versioning and opening a pull request
... tbd

# Workflow documentation
Refer to the documation in the individual scripts to understand the principles applied.




